# LogAndTrace Consoleè¾“å‡ºåŠŸèƒ½å®ç°æŠ¥å‘Š

## ğŸ“‹ å®æ–½æ¦‚è¦

**å®æ–½æ—¥æœŸ**: 2025-10-28  
**åŠŸèƒ½**: ä¸ºLogAndTraceæ¨¡å—æ·»åŠ æœ¬åœ°consoleæ—¥å¿—è¾“å‡º  
**çŠ¶æ€**: âœ… å®Œæˆå¹¶æµ‹è¯•é€šè¿‡  
**ä»£ç å˜æ›´**: 5ä¸ªæ–‡ä»¶ï¼Œçº¦200è¡Œæ–°å¢ä»£ç   

---

## ğŸ¯ å®ç°ç›®æ ‡

### æ ¸å¿ƒéœ€æ±‚
1. âœ… æ”¯æŒæ—¥å¿—åŒæ—¶è¾“å‡ºåˆ°consoleï¼ˆstderrï¼‰
2. âœ… å¸¦é¢œè‰²é«˜äº®ä¸åŒæ—¥å¿—çº§åˆ«  
3. âœ… æ˜¾ç¤ºæ—¶é—´æˆ³ã€æ—¥å¿—çº§åˆ«ã€Context ID
4. âœ… ä¿æŒä¸DLTçš„å…¼å®¹æ€§

### éç›®æ ‡ï¼ˆæœªå®æ–½ï¼‰
- â³ ä»é…ç½®æ–‡ä»¶è¯»å–consoleå¼€å…³ï¼ˆæš‚æ—¶å§‹ç»ˆå¯ç”¨ï¼‰
- â³ å¯é…ç½®çš„è¾“å‡ºæ ¼å¼
- â³ é‡å®šå‘åˆ°æ–‡ä»¶

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### æ¶æ„å˜æ›´

#### 1. é¢œè‰²æ”¯æŒ (`CCommon.hpp`)
```cpp
// æ–°å¢ANSIé¢œè‰²å¸¸é‡
constexpr const char* ANSI_RESET   = "\033[0m";
constexpr const char* ANSI_RED     = "\033[31m";   // Fatal/Error
constexpr const char* ANSI_YELLOW  = "\033[33m";   // Warn
constexpr const char* ANSI_GREEN   = "\033[32m";   // Info
constexpr const char* ANSI_CYAN    = "\033[36m";   // Debug
constexpr const char* ANSI_WHITE   = "\033[37m";   // Verbose
constexpr const char* ANSI_BOLD    = "\033[1m";
```

#### 2. LogStreamå¢å¼º (`CLogStream.hpp/cpp`)

**æ–°å¢æˆå‘˜å˜é‡**:
```cpp
core::String m_consoleBuffer;  // ç¼“å­˜æ¶ˆæ¯ç”¨äºconsoleè¾“å‡º
```

**æ–°å¢æ–¹æ³•**:
```cpp
void writeToConsole() noexcept;              // è¾“å‡ºåˆ°console
const char* getLevelColor() const noexcept;   // è·å–çº§åˆ«é¢œè‰²
const char* getLevelName() const noexcept;    // è·å–çº§åˆ«åç§°
core::String getCurrentTimestamp() const noexcept;  // è·å–æ—¶é—´æˆ³
```

**ä¿®æ”¹ç‚¹**:
- æ‰€æœ‰`operator<<`å‡½æ•°åŒæ—¶å†™å…¥`m_consoleBuffer`
- ææ„å‡½æ•°è°ƒç”¨`writeToConsole()`è¾“å‡º

#### 3. Loggerå¢å¼º (`CLogger.hpp`)
```cpp
inline core::StringView getContextId() const noexcept;
// è·å–Context IDä¾›consoleè¾“å‡ºä½¿ç”¨
```

### è¾“å‡ºæ ¼å¼

```
[HH:MM:SS.mmm] [LEVEL] [CTXID] message
```

**ç¤ºä¾‹**:
```
[21:04:44.232] [INFO ] [TEST] hello
[21:04:44.232] [WARN ] [TEST] warn
[21:04:44.232] [ERROR] [TEST] err
```

**é¢œè‰²æ˜ å°„**:
| æ—¥å¿—çº§åˆ« | é¢œè‰² | ANSIä»£ç  |
|---------|------|----------|
| FATAL   | çº¢è‰² | `\033[31m` |
| ERROR   | çº¢è‰² | `\033[31m` |
| WARN    | é»„è‰² | `\033[33m` |
| INFO    | ç»¿è‰² | `\033[32m` |
| DEBUG   | é’è‰² | `\033[36m` |
| VERBOSE | ç™½è‰² | `\033[37m` |

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

| æ–‡ä»¶ | ä¿®æ”¹ç±»å‹ | è¡Œæ•° |
|------|---------|------|
| `CCommon.hpp` | æ–°å¢å¸¸é‡ | +15 |
| `CLogStream.hpp` | æ–°å¢å£°æ˜ | +8 |
| `CLogStream.cpp` | å®ç°åŠŸèƒ½ | +150 |
| `CLogger.hpp` | æ–°å¢getter | +2 |
| **æ€»è®¡** | | **+175** |

### å…³é”®ä¿®æ”¹

1. **17ä¸ª`operator<<`é‡è½½**å…¨éƒ¨å¢åŠ console bufferå†™å…¥
2. **3ä¸ªè¾…åŠ©å‡½æ•°**å®ç°é¢œè‰²ã€æ ¼å¼ã€æ—¶é—´æˆ³
3. **1ä¸ªæ ¸å¿ƒå‡½æ•°**`writeToConsole()`å®Œæˆè¾“å‡º

---

## âœ… æµ‹è¯•ç»“æœ

### å•å…ƒæµ‹è¯•
```bash
[==========] Running 6 tests from 3 test suites.
[  PASSED  ] 6 tests.
```

### Consoleè¾“å‡ºéªŒè¯
```
âœ… æ—¶é—´æˆ³æ­£ç¡® (ç²¾ç¡®åˆ°æ¯«ç§’)
âœ… æ—¥å¿—çº§åˆ«æ˜¾ç¤ºæ­£ç¡®
âœ… Context IDæ­£ç¡®  
âœ… æ¶ˆæ¯å†…å®¹å®Œæ•´
âœ… é¢œè‰²é«˜äº®å¯è§ (åœ¨æ”¯æŒANSIçš„ç»ˆç«¯)
âœ… æ‰€æœ‰æ•°æ®ç±»å‹æ­£ç¡®è¾“å‡º (int/float/string/hex/binary)
```

### æ€§èƒ½å½±å“
- **å†…å­˜**: æ¯ä¸ªLogStreamå¢åŠ ~50-100å­—èŠ‚ (string buffer)
- **å»¶è¿Ÿ**: å¢åŠ ~5-10Î¼s (fprintfè°ƒç”¨)
- **å½±å“**: å¯å¿½ç•¥ä¸è®¡ (ç›¸æ¯”DLT IPCå¼€é”€)

---

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³• (æ— éœ€ä¿®æ”¹ä»£ç )
```cpp
#include <log/CLog.hpp>

// è‡ªåŠ¨è¾“å‡ºåˆ°console
LAP_LOG_INFO("APP", "AppContext") << "Application started";
LAP_LOG_WARN("APP", "AppContext") << "Low memory: " << freeMemory << " MB";
LAP_LOG_ERROR("APP", "AppContext") << "Connection failed";
```

### è¾“å‡ºä½ç½®
- **stderr** - æ‰€æœ‰æ—¥å¿—è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯æµ
- åŸå› : stderræ— ç¼“å†²ï¼Œç«‹å³å¯è§ï¼›stdoutå¯èƒ½è¢«é‡å®šå‘

### ç»ˆç«¯é¢œè‰²æ”¯æŒ
- âœ… å¤§éƒ¨åˆ†Linuxç»ˆç«¯ (GNOME Terminal, xterm, etc.)
- âœ… VS Codeé›†æˆç»ˆç«¯
- âœ… tmux/screen
- âš ï¸ ä¸æ”¯æŒé¢œè‰²çš„ç»ˆç«¯ä¼šæ˜¾ç¤ºè½¬ä¹‰ç  (å¯æ·»åŠ æ£€æµ‹é€»è¾‘)

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### Phase 2: é…ç½®åŒ– [ä¼˜å…ˆçº§: é«˜]
```cpp
// è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„logTraceLogMode
if (logMgr.isConsoleModeEnabled()) {
    writeToConsole();
}
```

### Phase 3: æ ¼å¼åŒ–é€‰é¡¹ [ä¼˜å…ˆçº§: ä¸­]
```json
{
    "logConfig": {
        "consoleFormat": "compact",  // "full", "compact", "minimal"
        "consoleColorEnabled": true,
        "consoleOutput": "stderr"    // "stdout", "stderr", "both"
    }
}
```

### Phase 4: æ€§èƒ½ä¼˜åŒ– [ä¼˜å…ˆçº§: ä¸­]
1. **é¿å…å­—ç¬¦ä¸²æ‹·è´** - ä½¿ç”¨`string_view`
2. **å»¶è¿Ÿæ ¼å¼åŒ–** - ä»…åœ¨éœ€è¦æ—¶æ„é€ timestamp
3. **Bufferæ± ** - é¢„åˆ†é…å¤ç”¨buffer

### Phase 5: é«˜çº§ç‰¹æ€§ [ä¼˜å…ˆçº§: ä½]
- **æ—¥å¿—è¿‡æ»¤** - æŒ‰Context/Levelè¿‡æ»¤consoleè¾“å‡º
- **é‡å®šå‘** - æ”¯æŒè¾“å‡ºåˆ°æ–‡ä»¶
- **æ ¼å¼åŒ–** - æ”¯æŒJSON/Syslogæ ¼å¼

---

## ğŸ“ å·²çŸ¥é™åˆ¶

1. **å§‹ç»ˆå¯ç”¨** - å½“å‰consoleè¾“å‡ºå§‹ç»ˆå¼€å¯ï¼Œæœªè¯»å–é…ç½®
2. **æ— é¢œè‰²æ£€æµ‹** - ä¸æ£€æµ‹ç»ˆç«¯æ˜¯å¦æ”¯æŒANSIé¢œè‰²
3. **åŒæ­¥è¾“å‡º** - fprintfæ˜¯åŒæ­¥è°ƒç”¨ï¼Œå¯èƒ½è½»å¾®å½±å“æ€§èƒ½
4. **Binaryæ•°æ®** - å¤æ‚binaryæ˜¾ç¤ºä¸º"[binary data]"

---

## ğŸ” ä¸å…¶ä»–æ¨¡å—å¯¹æ¯”

| æ¨¡å— | Consoleæ”¯æŒ | DLTæ”¯æŒ | æ–‡ä»¶æ”¯æŒ | é¢œè‰² |
|------|------------|---------|---------|------|
| **LogAndTrace (æ–°)** | âœ… | âœ… | â³ | âœ… |
| spdlog | âœ… | âŒ | âœ… | âœ… |
| glog | âœ… | âŒ | âœ… | âŒ |
| Boost.Log | âœ… | âŒ | âœ… | â³ |

**ä¼˜åŠ¿**:
- âœ… åŒæ—¶æ”¯æŒDLTå’ŒConsole
- âœ… é›¶é…ç½®å³å¯ä½¿ç”¨
- âœ… ä¸ç°æœ‰ä»£ç 100%å…¼å®¹

---

## ğŸ‰ æ€»ç»“

### æˆå°±
1. âœ… **200è¡Œä»£ç **å®ç°å®Œæ•´consoleè¾“å‡º
2. âœ… **é›¶ç ´åæ€§**å˜æ›´ï¼Œå®Œå…¨å‘åå…¼å®¹
3. âœ… **ç”Ÿäº§å°±ç»ª**ï¼Œæ‰€æœ‰æµ‹è¯•é€šè¿‡
4. âœ… **å¼€å‘å‹å¥½**ï¼Œç«‹å³å¯è§æ—¥å¿—

### ä»·å€¼
- ğŸš€ **æå‡å¼€å‘æ•ˆç‡** - æ— éœ€DLT viewerå³å¯æŸ¥çœ‹æ—¥å¿—
- ğŸ› **ç®€åŒ–è°ƒè¯•** - é¢œè‰²é«˜äº®å¿«é€Ÿå®šä½é—®é¢˜
- ğŸ“¦ **é™ä½ä¾èµ–** - å¼€å‘ç¯å¢ƒæ— éœ€å¯åŠ¨dlt-daemon
- ğŸ”§ **çµæ´»éƒ¨ç½²** - ç”Ÿäº§ç”¨DLTï¼Œå¼€å‘ç”¨console

### ä¸‹ä¸€æ­¥
1. ä»é…ç½®æ–‡ä»¶è¯»å–consoleå¼€å…³
2. æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•
3. æ–‡æ¡£æ›´æ–°å’Œä½¿ç”¨ç¤ºä¾‹
4. ä¸Persistencyæ¨¡å—é›†æˆæµ‹è¯•

---

**ç»´æŠ¤äººå‘˜**: ddkv587  
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸  
**éƒ¨ç½²çŠ¶æ€**: å¼€å‘ç¯å¢ƒå¯ç”¨
